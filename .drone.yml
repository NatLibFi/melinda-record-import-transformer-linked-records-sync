---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push

steps:

  - name: generate-tags
    image: quay.io/natlibfi/drone-gen-tags

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --audit-level=moderate --production

  - name: install
    image: node:12
    commands:
      - npm ci
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true

  - name: test
    image: node:12
    commands:
      - npm test

  - name: check-coverage
    image: node:12
    commands:
      - npm run check-coverage

  - name: build
    image: node:12
    commands:
      - npm run build

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: docker
    image: plugins/docker
    settings:
      repo: quay.io/natlibfi/
      registry: quay.io
      username:
        from_secret: docker_username
      password:
        from_secret: docker_password
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: docker_username
data:
---
kind: secret
name: docker_password
data:
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---

